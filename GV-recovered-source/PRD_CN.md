--- START OF FILE PRD.md (中文翻译版) ---

# 产品需求文档 (PRD)
## GV 板材优化开料系统

**文档版本:** 1.0
**最后更新:** 2025-11-08
**产品:** GV (板材优化开料系统)
**状态:** 基于生产代码逆向工程编写

---

## 目录

1. [执行摘要](#1-执行摘要)
2. [产品概述](#2-产品概述)
3. [问题陈述](#3-问题陈述)
4. [目标与宗旨](#4-目标与宗旨)
5. [目标用户与角色画像](#5-目标用户与角色画像)
6. [用户故事](#6-用户故事)
7. [功能需求](#7-功能需求)
8. [非功能性需求](#8-非功能性需求)
9. [用户界面规范](#9-用户界面规范)
10. [技术架构](#10-技术架构)
11. [数据模型](#11-数据模型)
12. [算法规范](#12-算法规范)
13. [集成需求](#13-集成需求)
14. [成功指标](#14-成功指标)
15. [约束与限制](#15-约束与限制)
16. [未来增强功能](#16-未来增强功能)
17. [依赖项](#17-依赖项)
18. [风险与缓解措施](#18-风险与缓解措施)
19. [附录](#19-附录)

---

## 1. 执行摘要

### 1.1 产品愿景

GV 是一款基于 Web 的板材优化开料系统，旨在最大限度地减少材料浪费，并提高家具制造业的生产效率。该系统通过自动为木板、胶合板和其他板材生成最优切割方案，以解决二维切割下料问题 (2D Cutting Stock Problem)。

### 1.2 商业价值

- **减少材料浪费:** 将板材利用率优化至 75-85%，降低原材料成本。
- **提高生产效率:** 自动化生成切割方案，将排版规划时间从数小时缩短至数秒。
- **提升制造质量:** 提供可视化的切割图和批量合并功能，确保生产一致性。
- **减少人为错误:** 消除材料估算中的手动计算错误。

### 1.3 目标市场

- 定制家具制造商 (衣柜、橱柜、书架)
- 厨柜制造商
- 木工车间
- 室内设计公司
- 建材供应商

### 1.4 核心功能

1. 支持纹理方向的多产品混合优化开料
2. 余料库存管理及优先利用
3. 生成带精确尺寸的可视化切割图
4. 为提高生产效率进行方案批量合并
5. 支持 7 种标准板材规格 (从 4×8 英尺到 5×10 英尺)
6. 可配置的锯口宽度和利用率阈值

---

## 2. 产品概述

### 2.1 产品类型

Web 应用程序 (基于 JSP)，配备服务器端优化引擎。

### 2.2 核心功能

GV 系统接收一个待从标准板材上切割的产品（家具部件）列表，并生成优化的切割方案，以实现：
- 最小化所需板材数量
- 最大化材料利用率
- 遵循纹理方向约束
- 优先利用库存余料
- 合并相同的切割方案以进行批量生产

### 2.3 产品范围

**范围内:**
- 二维矩形件切割优化
- 每次优化运行仅处理单一材料类型 (按颜色/厚度分组)
- 仅支持裁断式切割 (Guillotine cuts)，不支持任意形状
- 纹理方向约束 (单向 vs. 混合)
- 余料跟踪与再利用
- 生成可视化切割图
- 生成可供打印的切割说明

**范围外:**
- 三维优化或嵌套体积
- 弧形/不规则形状切割
- 多工厂分布式优化
- 实时库存管理集成
- CNC 机床直接控制
- 成本估算与报价

---

## 3. 问题陈述

### 3.1 当前挑战

**对于家具制造商:**
1. **手动计算效率低下:** 生产计划员为每个订单手动计算切割方案需花费 2-4 小时。
2. **材料浪费严重:** 手动排版仅能达到 60-70% 的材料利用率，导致 30-40% 的浪费。
3. **质量不一致:** 不同的计划员得出不同的结果，导致材料成本波动。
4. **余料管理困难:** 跟踪和再利用余料全凭手动，常导致可用材料被丢弃。
5. **规模化挑战:** 包含 50 个以上独特部件的大订单，手动优化变得极其复杂。

**商业影响:**
- 材料成本占家具制造成本的 40-60%。
- 20-30% 的浪费直接降低了利润率。
- 手动规划使每个订单的生产延迟 1-2 天。
- 不一致的切割方案使库存管理复杂化。

### 3.2 根本原因

1. **计算复杂性:** 二维切割下料问题是 NP-Hard 问题，手动优化在实践中不可行。
2. **工具缺乏:** 价格合理、支持中文的优化软件选择有限。
3. **需要领域专长:** 有效的手动优化需要多年经验。
4. **数据管理:** 跨多个任务跟踪余料需要系统化的流程。

---

## 4. 目标与宗旨

### 4.1 主要目标

| 目标 | 成功指标 | 指标值 |
|------|----------------|--------|
| 减少材料浪费 | 平均利用率 | ≥ 75% |
| 缩短规划时间 | 生成切割方案的时间 | < 30 秒 |
| 提高一致性 | 利用率的标准差 | < 5% |
| 实现余料再利用 | 余料再利用率 | ≥ 20% |
| 提高生产吞吐量 | 每日处理订单数 | +50% |

### 4.2 用户体验目标

1. **简洁性:** 非技术生产人员经过少于 10 分钟的培训即可使用本系统。
2. **速度:** 实时生成优化结果 (典型订单 < 5 秒)。
3. **清晰性:** 提供车间工人能轻松理解的可视化切割图。
4. **灵活性:** 支持常见的板材规格和可配置的切割参数。
5. **本地化:** UI 和文档完全支持中文。

### 4.3 商业目标

1. **降低成本:** 通过最小化浪费，将材料成本降低 10-15%。
2. **提升运营效率:** 将生产规划所需的人力减少 60-80%。
3. **改进质量:** 消除导致材料短缺的计算错误。
4. **建立竞争优势:** 为客户提供更快的报价和更低的价格。

---

## 5. 目标用户与角色画像

### 5.1 主要用户画像: 生产计划员

**基本信息:**
- 年龄: 28-45
- 角色: 生产计划经理
- 经验: 3-8 年家具制造经验
- 教育: 职业/技术学校

**目标:**
- 最小化材料浪费以达到公司成本目标
- 快速生成切割方案以维持生产计划
- 确保切割方案对车间工人清晰无误
- 跟踪余料以备未来任务使用

**痛点:**
- 手动计算耗时且易出错
- 在保持快速交付的同时，面临着优化成本的压力
- 难以跟踪和再利用余料
- 计划部门与车间之间存在沟通鸿沟

**技术水平:**
- 熟练使用基本电脑操作 (网页浏览器、电子表格)
- 不熟悉复杂软件或编程
- 偏好简单、直观的界面

### 5.2 次要用户画像: 车间主管

**基本信息:**
- 年龄: 35-55
- 角色: 车间主管/切割机操作员
- 经验: 10年以上木工经验
- 教育: 技术学校或学徒制

**目标:**
- 接收清晰、明确的切割指令
- 在实际切割操作中最小化材料浪费
- 识别并报告可再利用的余料
- 保持切割的准确性和质量

**痛点:**
- 手写或不清晰的切割图导致错误
- 对纹理方向的要求感到困惑
- 难以追踪哪个部件属于哪个订单
- 余料没有被系统地记录

**技术水平:**
- 基本的计算机知识 (可以查看和打印网页)
- 相比数字屏幕更偏好打印出的指令
- 重视简洁明了胜过功能丰富

### 5.3 第三用户画像: 工厂老板

**基本信息:**
- 年龄: 35-60
- 角色: 工厂老板/总经理
- 经验: 5-20 年家具行业经验

**目标:**
- 降低整体材料成本
- 提高生产效率和吞吐量
- 保持质量和一致性
- 进行数据驱动的决策

**痛点:**
- 对材料利用率缺乏可见性
- 难以比较不同计划员的效率
- 缺乏用于成本分析的历史数据
- 对优化软件的投资回报率不确定

---

## 6. 用户故事

### 6.1 核心用户故事

#### US-001: 生成基础切割方案
**作为一名** 生产计划员
**我希望** 输入家具部件列表后，能生成一个优化的切割方案
**以便于** 我可以最小化材料浪费并降低成本

**验收标准:**
- 可通过网页表单输入产品尺寸 (长、宽、厚)
- 可为每个产品指定数量
- 可从标准选项中选择板材规格 (4×8, 5×8 等)
- 系统在 < 5 秒内生成切割方案
- 显示材料利用率百分比
- 显示带尺寸标注的可视化切割图

#### US-002: 指定纹理方向
**作为一名** 生产计划员
**我希望** 将某些产品标记为“单向”(纹理方向重要)
**以便于** 系统能满足可见表面的木纹要求

**验收标准:**
- 可将每个产品标记为“单向”或“混合”
- 单向产品在切割方案中不会被旋转
- 混合产品可旋转 90° 以获得更好的优化效果
- 可视化图表中清晰地显示产品方向

#### US-003: 优先利用余料
**作为一名** 生产计划员
**我希望** 将之前任务产生的余料加入到优化计算中
**以便于** 在切割新板材之前，优先使用现有库存

**验收标准:**
- 可勾选“库存余料优先”复选框
- 可输入余料尺寸 (长、宽、厚、颜色)
- 系统会首先尝试将产品放置在余料上
- 显示哪些产品是从余料上切割，哪些是从新板材上切割
- 显示优化后剩余的余料

#### US-004: 批量方案合并
**作为一名** 生产计划员
**我希望** 相同的切割方案能被合并
**以便于** 车间工人可以用相同的设置一次性切割多张板材

**验收标准:**
- 系统能识别多张板材中相同的切割方案
- 对方案进行分组并显示批次数量 (例如，“此方案 ×3”)
- 通过合并重复项来减少可视化图表的数量
- 显示所有方案中每种产品的总数量

#### US-005: 打印切割说明
**作为一名** 车间主管
**我希望** 打印出带尺寸的清晰切割图
**以便于** 机器操作员能准确执行切割

**验收标准:**
- 打印按钮生成适合打印的格式
- 每张图表显示板材尺寸和所有产品的位置
- 产品编号、尺寸和位置都有清晰的标签
- 纹理方向有可视化标识
- 标记出可回收的余料区域

#### US-006: 配置切割参数
**作为一名** 生产计划员
**我希望** 调整锯口宽度和利用率阈值
**以便于** 优化结果能匹配我们的设备和质量标准

**验收标准:**
- 可设置锯口宽度为 2-6mm (默认: 3mm)
- 可设置最低利用率阈值为 0.50-0.90 (默认: 0.78)
- 系统在所有计算中都考虑了锯口损耗
- 只接受利用率高于阈值的切割方案

### 6.2 高级用户故事

#### US-007: 多颜色/材料分组
**作为一名** 生产计划员
**我希望** 产品能按颜色和厚度自动分组
**以便于** 每个切割方案只使用一种材料类型

**验收标准:**
- 系统按颜色名称 (花色) 对产品进行分组
- 系统按厚度 (厚度) 进行分组
- 为每个“颜色+厚度”的组合生成独立的切割方案
- 在结果中清晰地显示分组信息

#### US-008: 处理混合厚度
**作为一名** 生产计划员
**我希望** 一个包含多种厚度的订单能被分开优化
**以便于** 每种厚度都有其专属的优化切割方案

**验收标准:**
- 不同厚度的产品在不同的批次中处理
- 每种厚度都显示其独立的材料利用率统计数据
- 余料按厚度进行跟踪

#### US-009: 查看余料总结
**作为一名** 生产计划员
**我希望** 在优化后能看到一份详细的余料列表
**以便于** 我能将它们添加到库存中以备未来使用

**验收标准:**
- 系统计算出所有大于最小尺寸 (例如 200×200mm) 的余料
- 显示余料的尺寸、在板材上的位置和数量
- 按类型对余料进行分类 (边料、角料、中心料)
- 提供导出余料列表的选项

---

## 7. 功能需求

### 7.1 产品输入与配置

#### FR-001: 产品数据录入
**优先级:** P0 (关键)
**描述:** 用户可通过网页表单输入产品规格。

**详情:**
- **必填字段:**
  - 编号: 字母数字标识符 (例如 "A001")
  - 名称: 描述性名称 (例如 "侧板")
  - 长: 整数, 毫米 (例如 2000)
  - 宽: 整数, 毫米 (例如 600)
  - 厚: 整数, 毫米 (例如 18)
  - 花色: 文本 (例如 "白橡木")
  - 数量: 整数, 件数 (例如 2)
  - 纹理方向: 单选按钮 (单向/混合)

- **输入方式:**
  - 带“添加行”按钮的网页表单，用于多个产品
  - 每行支持逗号分隔值 (CSV) 格式
  - 每次优化最多支持 100 种产品

- **验证:**
  - 所有尺寸必须 > 0 且 < 10,000mm
  - 数量必须 ≥ 1 且 ≤ 999
  - 产品编号在同一订单内必须唯一
  - 厚度必须与可用板材厚度匹配

#### FR-002: 板材配置
**优先级:** P0 (关键)
**描述:** 用户可以选择板材规格并配置切割参数。

**详情:**
- **板材规格选择:** 下拉菜单选项:
  - 4×8 呎 (1220 × 2440 mm)
  - 5×8 呎 (1530 × 2440 mm)
  - 4×9 呎 (1220 × 2750 mm)
  - 5×9 呎 (1530 × 2750 mm)
  - 4×10 呎 (1220 × 3060 mm)
  - 5×10 呎 (1530 × 3060 mm)
  - 自定义 (用户定义的尺寸)

- **裁切锯口尺寸:** 数字输入, 2-6mm, 默认 3mm
- **板材利用率:** 数字输入, 0.50-0.90, 默认 0.78
- **优化尝试次数:** 隐藏参数, 默认 6 次随机放置尝试

#### FR-003: 余料管理
**优先级:** P1 (高)
**描述:** 用户可以添加库存中的余料。

**详情:**
- **启用/禁用:** 复选框 "库存余料优先"
- **余料输入字段:**
  - 长: 整数, 毫米
  - 宽: 整数, 毫米
  - 厚: 整数, 毫米
  - 花色: 文本 (必须与产品颜色匹配)
  - 数量: 整数, 余料件数

- **行为:**
  - 启用时，系统会优先尝试将产品放置在余料上
  - 余料被视为优先材料
  - 未使用的余料将保留在余料库存中
  - 从优化中产生的新余料将被添加到列表中

### 7.2 优化引擎

#### FR-004: 切割方案生成
**优先级:** P0 (关键)
**描述:** 系统使用二维装箱算法生成优化的切割方案。

**算法要求:**
- **分组阶段:**
  - 按“颜色+厚度”对产品进行分组
  - 按“颜色+厚度”对材料进行分组
  - 独立处理每个分组

- **放置策略:**
  - 按面积对产品进行排序 (从大到小)
  - 对每张板材:
    - 尝试 6 次随机放置方向
    - 仅使用裁断式切割 (无任意角度)
    - 递归地用较小的产品填充剩余空间
    - 选择利用率最高的放置方案

- **利用率计算:**
  - 利用率 = sum(产品面积) / 板材面积
  - 如果利用率 ≥ 阈值，则接受该方案
  - 所有尺寸计算均考虑锯口损耗

- **余料处理:**
  - 跟踪每次切割产生的余料
  - 尝试用其他产品填充余料区域
  - 将小于 200×200mm 的余料标记为不可再利用的废料

#### FR-005: 纹理方向约束
**优先级:** P0 (关键)
**描述:** 系统遵循纹理方向设置。

**详情:**
- **单向产品:**
  - 不能旋转 90°
  - 长度方向是固定的
  - 通常用于可见表面 (门板、抽屉面板)

- **混合产品:**
  - 如果能提高利用率，可以旋转 90°
  - 系统会尝试两种方向并选择最优的
  - 通常用于内部构件 (层板、隔板)

- **可视化标识:**
  - 切割图用箭头或标记显示纹理方向
  - 单向产品在图中使用不同的颜色/图案

#### FR-006: 方案合并
**优先级:** P1 (高)
**描述:** 系统合并相同的切割方案以进行批量生产。

**详情:**
- **方案匹配:**
  - 通过尺寸、位置和产品列表比较切割方案
  - 布局完全相同的方案将被合并
  - 显示合并方案的批次数量 (m_u_count)

- **好处:**
  - 减少大订单的图纸数量
  - 允许车间一次性设置切割机以处理多张板材
  - 提高生产效率

- **显示:**
  - 显示 "此方案 ×3" 或类似标记
  - 列出所有使用此方案的板材
  - 显示所有相同方案中的产品总数

### 7.3 输出与可视化

#### FR-007: 可视化切割图
**优先级:** P0 (关键)
**描述:** 系统生成可视化图表，显示产品在板材上的布局。

**图表元素:**
- **板材边界:** 代表完整板材尺寸的矩形
- **产品矩形:** 每个产品显示为一个矩形，包含:
  - 产品编号 (例如 "A001")
  - 尺寸 (例如 "2000×600")
  - 位置坐标 (左上角)
  - 纹理方向指示器 (如果是单向产品)

- **尺寸标注:**
  - 所有尺寸单位为毫米
  - 位置坐标 (X, Y) 以左上角为原点
  - 余料区域尺寸

- **颜色编码:**
  - 不同产品使用不同颜色 (如果显示器支持)
  - 余料区域显示为灰色或白色
  - 废料区域 (太小无法再利用) 用阴影线表示

- **图例:**
  - 包含编号和数量的产品列表
  - 板材尺寸和利用率百分比
  - 所需板材总数

#### FR-008: 材料利用率统计
**优先级:** P1 (高)
**描述:** 系统计算并显示材料效率指标。

**指标:**
- **单板利用率:** 每张板材被产品占用的百分比
- **整体利用率:** 所有板材的平均利用率
- **所需板材总数:** 需要的板材数量
- **产品总面积:** 所有产品面积之和
- **废料总面积:** 所有余料面积之和
- **可复用余料数量:** 可再利用的余料件数
- **不可复用废料:** 太小而无法回收的废料面积

**显示格式:**
```
材料总结:
- 所需板材总数: 3 张
- 板材规格: 4×8 呎 (1220×2440mm)
- 整体利用率: 82.3%
- 产品总面积: 7,350,000 mm²
- 废料总面积: 1,580,000 mm²
- 可复用余料: 12 件
```

#### FR-009: 余料报告
**优先级:** P1 (高)
**描述:** 系统生成余料列表以供库存管理。

**报告内容:**
- **余料详情:**
  - 尺寸 (长 × 宽)
  - 厚度和颜色
  - 来源板材编号
  - 在板材上的位置 (供切割参考)
  - 数量 (如果有多件相同的余料)

- **分类:**
  - 类型: 左边料, 顶边料, 角料, 中心料
  - 尺寸类别: 大 (>600mm), 中 (300-600mm), 小 (200-300mm)
  - 可复用性: 可复用 vs. 太小无法保存

- **导出选项:**
  - 打印为 PDF
  - 复制到剪贴板，用于手动录入库存系统

#### FR-010: 打印就绪输出
**优先级:** P0 (关键)
**描述:** 用户可以打印切割图供车间使用。

**打印功能:**
- **格式:** 标准 A4 或 Letter 尺寸页面
- **布局:** 每页一个切割方案 (如果方案小，则可多个)
- **内容:**
  - 板材编号和方案标识符
  - 包含所有尺寸的完整图纸
  - 包含编号、名称、尺寸、数量的产品列表表格
  - 切割顺序建议 (如果适用)
  - 批处理信息 (如果方案重复)

- **质量:**
  - 高对比度黑白 (为了清晰)
  - 大号、易读的字体 (最小 10pt)
  - 清晰的线条图 (无抗锯齿伪影)

### 7.4 数据持久化 (可选)

#### FR-011: 保存优化结果
**优先级:** P2 (中)
**描述:** 用户可以保存优化结果以备将来参考。

**详情:**
- **保存格式:** JSON 或 XML
- **保存的数据:**
  - 产品规格
  - 板材配置
  - 生成的切割方案
  - 材料统计数据
  - 时间戳和用户标识符

- **检索:**
  - 加载已保存的结果以查看/修改
  - 导出到外部系统

**注意:** 当前实现以 JSON 格式返回结果，但未持久化到数据库。

---

## 8. 非功能性需求

### 8.1 性能

#### NFR-001: 响应时间
- **要求:** 对于典型订单，在 < 5 秒内生成优化结果。
- **典型订单:** 20-50 种产品, 1-3 个材料分组。
- **最大订单:** 100 种产品, < 30 秒。
- **测量:** 正常负载下的 95 百分位响应时间。

#### NFR-002: 可伸缩性
- **并发用户:** 支持 10 个并发优化请求。
- **峰值负载:** 工作时间内每小时处理 50 个请求。
- **资源限制:** 每个优化请求最多使用 2GB 内存。

#### NFR-003: 优化质量
- **最低利用率:** 平均材料利用率达到 ≥ 75%。
- **一致性:** 多次运行的利用率标准差 < 5% (注意: 当前实现使用随机化)。
- **减少浪费:** 与手动规划相比，材料浪费减少 ≥ 10%。

### 8.2 可用性

#### NFR-004: 学习曲线
- **培训时间:** 用户应在 10 分钟培训内即可高效使用。
- **界面复杂度:** 最多点击 3 次即可生成切割方案。
- **错误恢复:** 提供清晰的错误信息和修正指导。

#### NFR-005: 可访问性
- **语言:** 完全支持中文 (简体中文)。
- **浏览器兼容性:** 支持 IE 11+, Chrome, Firefox, Edge。
- **屏幕分辨率:** 最低支持 1024×768。
- **输入方式:** 支持仅键盘导航。

#### NFR-006: 视觉清晰度
- **图表易读性:** 在 100% 缩放下所有尺寸清晰可读。
- **配色方案:** 高对比度，以适应明亮的车间环境。
- **打印质量:** 黑白打印时图表依然清晰。

### 8.3 可靠性

#### NFR-007: 可用性
- **正常运行时间目标:** 工作时间 (8am-8pm, 每周7天) 内达到 99%。
- **计划内维护:** 每月最多 4 小时，在非工作时间进行。
- **恢复时间:** 发生故障时 < 1 小时。

#### NFR-008: 数据完整性
- **计算准确性:** 所有尺寸计算精确到 0.1mm。
- **无数据丢失:** 显示的优化结果必须准确且可复现。
- **错误处理:** 拒绝无效输入并提供清晰的错误信息。

#### NFR-009: 容错性
- **输入验证:** 阻止处理无效数据。
- **优雅降级:** 如果优化无法完成，显示部分结果。
- **错误日志:** 记录所有错误以便调试。

### 8.4 安全性

#### NFR-010: 认证 (未来)
- **用户访问:** 当前版本无需认证。
- **未来:** 支持用户登录和基于角色的访问控制。

#### NFR-011: 数据隐私
- **客户数据:** 产品规格不应被记录或共享。
- **隔离:** 每个优化会话都是隔离的 (无交叉污染)。

### 8.5 可维护性

#### NFR-012: 代码质量
- **模块化:** 分离表现层、业务逻辑层和数据层。
- **文档化:** 为复杂算法编写代码注释。
- **测试:** 为核心优化逻辑编写单元测试 (目前缺乏)。

#### NFR-013: 配置
- **板材规格:** 板材规格列表可配置，无需修改代码 (目前为硬编码)。
- **算法参数:** 可调参数 (锯口、利用率阈值、放置尝试次数)。

### 8.6 兼容性

#### NFR-014: 平台支持
- **服务器:** Java 7+ 运行时环境。
- **应用服务器:** Apache Tomcat 8.5.x 或兼容版本。
- **操作系统:** Linux, Windows Server。
- **数据库:** 无需 (无状态操作)。

#### NFR-015: 集成
- **输入格式:** 接受 CSV 或网页表单输入。
- **输出格式:** JSON 用于程序化访问，HTML 用于显示，打印用于车间。
- **API:** 通过 Struts action 提供 RESTful 端点，用于外部系统集成。

---

## 9. 用户界面规范

### 9.1 页面布局

#### 页面: 产品输入 (input.jsp)

**布局结构:**
```
+----------------------------------------------------------+
|  [Logo]  GV板材优化开料系统                                |
+----------------------------------------------------------+
|  产品构件开料明细                                          |
|                                                          |
|  [添加 按钮]                                             |
|                                                          |
|  +------------------------------------------------------+ |
|  | 编号 | 名称 | 长 | 宽 | 厚 | 花色 | 数量 | 纹理方向       | |
|  |------|------|----|----|----|----|------|-------------| |
|  | A001 | 侧板 |2000| 600| 18 |白橡木|  2  | ○单向 ○混合  | |
|  | [输入字段继续...]                                     | |
|  +------------------------------------------------------+ |
|                                                          |
|  板材配置                                                |
|  +------------------------------------------------------+ |
|  | 板材规格: [下拉菜单: 4×8 呎 ▼]                          | |
|  | 锯口尺寸: [输入框: 3] mm                                | |
|  | 利用率:   [输入框: 0.78]                               | |
|  +------------------------------------------------------+ |
|                                                          |
|  ☐ 库存余料优先                                          |
|                                                          |
|  [余料输入区域 - 默认隐藏]                               |
|                                                          |
|  [确认完成 按钮]  [确认开板 按钮]                          |
+----------------------------------------------------------+
```

**输入表单规范:**
- **表格布局:** 带有“添加”按钮的动态表格。
- **字段宽度:**
  - 编号: 80px
  - 名称: 120px
  - 长/宽/厚: 各 60px
  - 花色: 100px
  - 数量: 50px
  - 纹理: 150px (单选按钮)

- **输入验证:**
  - 数字字段只接受整数
  - 尺寸范围: 1-10,000
  - 数量范围: 1-999
  - 必填字段指示符 (红色星号)

- **操作:**
  - "添加": 添加新的产品行
  - "确认完成": 验证输入
  - "确认开板": 提交进行优化

#### 页面: 切割方案结果 (result.jsp)

**布局结构:**
```
+----------------------------------------------------------+
|  [Logo]  GV板材优化开料系统 - 开料方案                       |
+----------------------------------------------------------+
|  材料统计                                                |
|  +------------------------------------------------------+ |
|  | 总用板数: 3 张                                          | |
|  | 板材规格: 4×8 呎 (1220×2440mm)                          | |
|  | 平均利用率: 82.3%                                       | |
|  | 总产品面积: 7,350,000 mm²                               | |
|  | 余料数量: 12 件                                         | |
|  +------------------------------------------------------+ |
|                                                          |
|  开料图                                                  |
|                                                          |
|  板材 #1 - 利用率: 85.2% (重复 2 次)                       |
|  +------------------------------------------------------+ |
|  |                                                      | |
|  |  +-----------+  +--------+                          | |
|  |  |  A001     |  | A002   |                          | |
|  |  | 2000×600  |  | 900×600|                          | |
|  |  |           |  |        |                          | |
|  |  +-----------+  +--------+                          | |
|  |                                                      | |
|  |  [余料: 1220×840]                                   | |
|  |                                                      | |
|  +------------------------------------------------------+ |
|                                                          |
|  产品清单                                                |
|  +------------------------------------------------------+ |
|  | 产品编号 | 名称 | 尺寸 | 数量 | 已排 | 未排 |            | |
|  |---------|------|------|------|------|------|           | |
|  | A001    | 侧板 | 2000×600×18 | 2 | 2 | 0 |           | |
|  | A002    | 顶板 | 900×600×18  | 2 | 2 | 0 |           | |
|  +------------------------------------------------------+ |
|                                                          |
|  余料清单                                                |
|  +------------------------------------------------------+ |
|  | 尺寸 | 厚度 | 花色 | 数量 | 位置 |                      | |
|  |------|------|------|------|------|                     | |
|  | 1220×840 | 18 | 白橡木 | 1 | 板材#1 右侧 |           | |
|  | 600×400  | 18 | 白橡木 | 2 | 板材#2 顶部 |           | |
|  +------------------------------------------------------+ |
|                                                          |
|  [打印 按钮]  [返回修改 按钮]  [保存方案 按钮]              |
+----------------------------------------------------------+
```

**图表规范:**
- **画布:** 用于可视化渲染的 SVG 或 Canvas 元素。
- **坐标系:** 左上角原点 (0,0)。
- **缩放:** 自动缩放以适应显示区域，同时保持纵横比。
- **颜色:**
  - 产品矩形: 浅蓝色 (#E3F2FD)
  - 产品边框: 深蓝色 (#1976D2)
  - 余料区域: 浅灰色 (#F5F5F5)
  - 废料区域: 阴影线图案
  - 板材边界: 黑色 2px 边框

- **标签:**
  - 产品编号: 粗体, 14px
  - 尺寸: 常规, 12px
  - 位置坐标: 小号, 10px, 灰色

- **交互功能 (未来):**
  - 悬停高亮产品并显示详情
  - 点击产品以在产品列表中查看
  - 缩放控件

### 9.2 视觉设计指南

#### 调色板
- **主色:** 蓝色 (#1976D2) - 用于操作、标题
- **次色:** 灰色 (#757575) - 用于标签、边框
- **强调色:** 绿色 (#4CAF50) - 用于成功状态、利用率 > 80%
- **警告色:** 橙色 (#FF9800) - 用于利用率 60-80%
- **错误色:** 红色 (#F44336) - 用于验证错误、利用率 < 60%
- **背景色:** 白色 (#FFFFFF)
- **表面色:** 浅灰色 (#FAFAFA)

#### 字体
- **标题:** 黑体, 18-24px, 粗体
- **正文:** 宋体, 14px, 常规
- **输入框:** Arial, 14px (为了更好的数字可读性)
- **图表:** Arial, 10-14px

#### 间距
- **内边距:** 标准 16px, 紧凑 8px
- **外边距:** 区块间 24px, 元素间 12px
- **网格:** 12 列响应式网格 (尽管当前版本仅为桌面版)

---

## 10. 技术架构

### 10.1 架构概述

**架构模式:** 基于 Struts 2 框架的 Model-View-Controller (MVC)

```
┌─────────────────────────────────────────────────────────────┐
│                           表现层 (Presentation)             │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐      │
│  │  input.jsp   │  │ result.jsp   │  │ print.jsp    │      │
│  │  (产品输入)   │  │ (切割结果)   │  │ (打印视图)   │      │
│  └──────┬───────┘  └──────▲───────┘  └──────▲───────┘      │
│         │                 │                  │              │
└─────────┼─────────────────┼──────────────────┼──────────────┘
          │                 │                  │
┌─────────▼─────────────────┴──────────────────┴──────────────┐
│                           控制层 (Controller)               │
│  ┌──────────────────────────────────────────────────────┐   │
│  │          ViewAction (Struts 2 Action)                │   │
│  │  - createView()                                      │   │
│  │  - processProducts()                                 │   │
│  │  属性: product_no[], product_name[], ...              │   │
│  └─────────────────────┬────────────────────────────────┘   │
│                        │                                     │
└────────────────────────┼─────────────────────────────────────┘
                         │
┌────────────────────────▼─────────────────────────────────────┐
│                         业务逻辑层 (Business Logic)           │
│  ┌──────────────────────────────────────────────────────┐   │
│  │           ViewServiceR2 (优化引擎)                   │   │
│  │  - createView(products, materials, saw_bite, scale)  │   │
│  │  - processProduct() - 分组产品                       │   │
│  │  - processMaterial() - 分组材料                      │   │
│  │  - scoreMaterial() - 排序材料                        │   │
│  │  - scoreAreaProduct() - 按面积排序产品               │   │
│  │  - queryUsedProducts() - 合并方案                    │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │                        工具类 (Utility)              │   │
│  │  - CommonTools: 通过序列化实现深度克隆               │   │
│  │  - DecimalMath: 精确计算 (BigDecimal)                │   │
│  └──────────────────────────────────────────────────────┘   │
└──────────────────────────────────────────────────────────────┘
                         │
┌────────────────────────▼─────────────────────────────────────┐
│                         数据层 (Data)                       │
│  ┌──────────────────────────────────────────────────────┐   │
│  │                    领域模型 (Domain)                   │   │
│  │  - Product: 家具构件                                 │   │
│  │  - Material: 板材                                    │   │
│  │  - Scheme: 产品-材料映射                             │   │
│  │  - Constant: 板材规格定义                            │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                              │
│  [无数据库层 - 无状态操作]                                   │
└──────────────────────────────────────────────────────────────┘
```

### 10.2 技术栈

#### 服务器端
- **语言:** Java 7
- **框架:** Struts 2.3.1.2
- **依赖注入:** Spring 3.0.6
- **应用服务器:** Apache Tomcat 8.5.x
- **构建工具:** Shell 脚本 + javac (无 Maven/Gradle)

#### 客户端
- **HTML:** JSP (JavaServer Pages)
- **CSS:** 内联 + 外部样式表
- **JavaScript:** jQuery (可能，用于动态表单操作)
- **图形:** SVG 或 Canvas 用于切割图

#### 库与依赖
- **Spring Framework 3.0.6:**
  - spring-core, spring-beans, spring-context
  - spring-web, spring-aop
  - spring-jdbc, spring-transaction (未使用)

- **Struts 2:**
  - struts2-core-2.3.1.2.jar
  - struts2-spring-plugin-2.2.3.1.jar
  - struts2-json-plugin-2.2.3.1.jar (用于 JSON 输出)
  - xwork-core-2.3.1.2.jar
  - ognl-3.0.4.jar

- **Commons 库:**
  - commons-io-2.0.1.jar
  - commons-lang-2.5.jar
  - commons-fileupload-1.2.2.jar
  - commons-logging.jar

- **其他:**
  - freemarker-2.3.18.jar (模板引擎)
  - javassist-3.11.0.GA.jar (字节码操作)
  - log4j-1.2.14.jar (日志)

### 10.3 部署架构

**单服务器部署:**
```
┌─────────────────────────────────────────┐
│              Linux 服务器 (生产)          │
│                                         │
│  ┌───────────────────────────────────┐ │
│  │    Apache Tomcat 8.5.57           │ │
│  │                                   │ │
│  │  服务: Catalina2 (端口 8089)     │ │
│  │  ┌─────────────────────────────┐ │ │
│  │  │  GV.war                     │ │ │
│  │  │  - WEB-INF/classes/         │ │ │
│  │  │  - WEB-INF/lib/             │ │ │
│  │  │  - *.jsp, *.html, *.jpg     │ │ │
│  │  └─────────────────────────────┘ │ │
│  └───────────────────────────────────┘ │
│                                         │
│  [无需数据库]                           │
└─────────────────────────────────────────┘
          │
          ▼
      浏览器 (客户端)
   http://server:8089/GV/input.jsp
```

**可伸缩性说明:**
- 当前架构为每个请求单线程处理
- 无会话状态 (无状态优化)
- 可通过负载均衡器水平扩展 (未来)
- 无共享数据库，因此无数据一致性问题

### 10.4 数据流

**请求处理流程:**
```
1. 用户在 input.jsp 中填写表单
   - 输入产品数据
   - 选择板材配置
   - 点击“确认开板”

2. 浏览器向 /GV/createView.action 提交 POST 请求
   - 参数: product_no[], product_name[], product_height[], ...
   - Content-Type: application/x-www-form-urlencoded

3. Struts 2 拦截器链处理请求
   - 将参数绑定到 ViewAction 的属性
   - 验证 (如果配置)
   - 调用 Action

4. ViewAction.createView() 执行
   - 将 CSV 数组解析为 Product 对象
   - 为可旋转的产品创建旋转变体
   - 从 Constant.class 加载 Material 定义
   - 调用 ViewServiceR2.createView()

5. ViewServiceR2.createView() 执行优化
   - 按“颜色+厚度”分组产品
   - 按“颜色+厚度”分组材料
   - 对每个分组:
     - 排序材料和产品
     - 尝试 6 次随机放置
     - 选择最佳方案 (利用率最高)
     - 递归填充剩余区域
   - 合并相同的方案
   - 计算余料

6. ViewServiceR2 返回 List<Material>
   - 每个 Material 包含已放置的产品
   - 嵌套的 m_materials 用于表示余料区域
   - 计算统计数据 (利用率、浪费等)

7. ViewAction 设置结果属性
   - materials = 优化的材料列表
   - result = "success"

8. Struts 返回到 result.jsp
   - 遍历 materials 渲染图表
   - 显示统计数据
   - 显示产品和余料列表

9. 浏览器渲染 HTML 响应
   - 用户查看切割图
   - 可选择打印或修改
```

---

## 11. 数据模型

### 11.1 产品模型 (Product)

**类:** `com.gv.model.Product`
**目的:** 表示一个待从板材上切割的家具构件。

**属性:**

| 字段 | 类型 | 描述 | 示例 | 约束 |
|-------|------|-------------|---------|-------------|
| p_no | String | 产品编号/标识符 | "A001" | 唯一, 1-20 字符 |
| p_name | String | 产品名称 | "侧板" | 1-50 字符 |
| p_height | double | 长度 (mm) | 2000.0 | > 0, < 10000 |
| p_width | double | 宽度 (mm) | 600.0 | > 0, < 10000 |
| p_weight | double | 厚度 (mm) | 18.0 | > 0, < 100 |
| p_color | String | 材料颜色/类型 | "白橡木" | 1-30 字符 |
| p_count | int | 总需求数量 | 2 | ≥ 1, ≤ 999 |
| p_r_count | int | 待排版剩余数量 | 0-2 | ≥ 0 |
| p_is_dir | int | 纹理方向: 0=可旋转, 1=固定 | 1 | 0 或 1 |
| p_is_copy | int | 旋转变体标志 | 0 | 0 或 1 |
| p_is_show | int | 排版状态: 0=未排, 1=已排 | 1 | 0 或 1 |
| m_left | double | 在材料上的 X 坐标 (mm) | 0.0 | ≥ 0 |
| m_top | double | 在材料上的 Y 坐标 (mm) | 0.0 | ≥ 0 |
| p_n_left | double | 归一化 X 坐标 | 0.0 | ≥ 0 |
| p_n_top | double | 归一化 Y 坐标 | 0.0 | ≥ 0 |
| p_is_score | int | 方案评分标志 | 0 | 0 或 1 |
| p_i_score | int | 实例评分标志 | 0 | 0 或 1 |
| p_p_count | int | 方案出现次数 | 1 | ≥ 0 |
| p_products | List<Product> | 嵌套产品 (旋转变体) | null | 可选 |

**序列化:** 实现 `Serializable` 以支持深度克隆。

**业务规则:**
- 如果 `p_is_dir = 0`，系统会创建一个长宽互换的旋转变体。
- `p_r_count` 随着产品被放置到材料上而递减。
- 当产品被放置到材料上时，设置 `m_left` 和 `m_top`。
- `p_is_show = 1` 标记产品为已放置，并引用父材料的 node_id。

### 11.2 材料模型 (Material)

**类:** `com.gv.model.Material`
**目的:** 表示一张板材，包含已放置的产品和余料区域。

**属性:**

| 字段 | 类型 | 描述 | 示例 | 约束 |
|-------|------|-------------|---------|-------------|
| m_name | String | 板材规格名称 | "4 x 8 呎" | 1-20 字符 |
| m_height | double | 板材高度 (mm) | 2440.0 | > 0 |
| m_width | double | 板材宽度 (mm) | 1220.0 | > 0 |
| m_count | int | 此规格板材数量 | 1 | ≥ 1 |
| m_weight | double | 厚度 (mm) | 18.0 | > 0 |
| m_color | String | 材料颜色/类型 | "白橡木" | 1-30 字符 |
| r_height | double | 剩余可用高度 | 2440.0 | ≥ 0 |
| r_width | double | 剩余可用宽度 | 1220.0 | ≥ 0 |
| m_m_left | double | X 坐标 (用于子材料) | 0.0 | ≥ 0 |
| m_m_top | double | Y 坐标 (用于子材料) | 0.0 | ≥ 0 |
| m_is_show | int | 处理状态: 0=活动, 1=已处理 | 0 | 0 或 1 |
| m_is_yl | int | 余料标志: 0=主材, 1=余料 | 0 | 0 或 1 |
| m_is_dk | int | 暗键标志 | 0 | 0 或 1 |
| m_is_p_info | int | 产品信息标志 | 0 | 0 或 1 |
| m_area_used | double | 利用率 (0.0-1.0) | 0.823 | 0.0-1.0 |
| m_u_count | int | 批次数量 (相同方案) | 3 | ≥ 1 |
| m_c_type | int | 切割类型: 0=垂直, 1=水平 | 0 | 0 或 1 |
| m_hs_type | int | 水平/垂直分割类型 | 0 | 0-2 |
| m_y_is_ud | int | 余料位置: 0=左, 1=上, 2=角 | 0 | 0-2 |
| m_f_id | int | 父材料节点 ID | 0 | ≥ 0 |
| m_node_id | int | 当前材料节点 ID | 1 | > 0 |
| m_products | List<Product> | 放置在此板材上的产品 | [...] | 可选 |
| m_materials | List<Material> | 子材料 (余料区域) | [...] | 可选 |
| m_y_materials | List<Material> | 可复用的余料 | [...] | 可选 |
| m_i_products | List<Product> | 合并后的产品列表 | [...] | 可选 |
| m_material_map | Map<String, List<Material>> | 按尺寸区分的材料变体 | {...} | 可选 |

**序列化:** 实现 `Serializable` 以支持深度克隆。

**业务规则:**
- `r_height` 和 `r_width` 表示放置产品后的可用空间。
- `m_products` 包含直接放置在此板材上的所有产品。
- `m_materials` 包含可被递归填充的余料区域。
- `m_y_materials` 包含足够大可复用的余料 (>= 200×200mm)。
- `m_area_used` = sum(产品面积) / (m_height × m_width)。
- `m_u_count` > 1 表示此方案重复多次 (批量生产)。
- 树形结构: `m_f_id` 指向父节点, `m_node_id` 是唯一标识符。

### 11.3 方案模型 (Scheme)

**类:** `com.gv.model.Scheme`
**目的:** 将产品映射到材料 (简单的关联)。

**属性:**

| 字段 | 类型 | 描述 | 示例 |
|-------|------|-------------|---------|
| p_no | String | 产品编号 | "A001" |
| m_no | String | 材料标识符 | "Sheet_1" |
| c_type | int | 切割类型/配置 | 0 |

**用途:** 在当前实现中用途极少；似乎是遗留或未来的功能。

### 11.4 常量配置 (Constant)

**类:** `com.gv.constant.Constant`
**目的:** 定义可用于切割的标准板材规格。

**静态初始化:**
```java
public class Constant {
    public static List<Material> MATERIAL_LIST = new ArrayList<Material>();

    static {
        // 5x10 呎 - 1530 x 3060 mm
        Material m1 = new Material();
        m1.setM_name("5 x 10");
        m1.setM_height(3060);
        m1.setM_width(1530);
        MATERIAL_LIST.add(m1);

        // ... 其他尺寸 ...
    }
}
```

**支持的板材规格:**
1. 5×10 呎: 1530 × 3060 mm
2. 5×8 呎: 1530 × 2440 mm
3. 4×8 呎: 1220 × 2440 mm (最常用)
4. 5×8 呎: 1530 × 2440 mm (重复条目)
5. 4×9 呎: 1220 × 2750 mm
6. 4×10 呎: 1220 × 3060 mm
7. 5×9 呎: 1530 × 2750 mm

---

## 12. 算法规范

### 12.1 算法分类

**问题类型:** 二维切割下料问题 (2D-CSP)
**复杂度:** NP-Hard
**方法:** 带随机多起点重启的贪心启发式算法
**变体:** 带纹理方向约束的裁断式切割

### 12.2 算法伪代码

```
FUNCTION createView(products[], materials[], saw_bite, scale_threshold):
    // 阶段 1: 分组
    product_groups = processProduct(products)  // 按颜色+厚度分组
    material_groups = processMaterial(materials)  // 按颜色+厚度分组

    result_materials = []
    node_id = 0

    // 阶段 2: 按组优化
    FOR EACH product_group IN product_groups:
        group_key = product_group.key  // 例如 "18*白橡木"
        group_products = product_group.products
        group_materials = material_groups[group_key]

        scoreMaterial(group_materials)  // 排序: 非余料优先

        // 阶段 3: 材料迭代
        FOR EACH material IN group_materials:
            WHILE (group_products 仍有未排版项):
                scoreAreaProduct(group_products)  // 按面积降序排序

                best_pattern = null
                best_utilization = 0

                // 阶段 4: 多次尝试优化
                FOR attempt = 1 TO 6:
                    temp_material = clone(material)
                    temp_products = clone(group_products)

                    // 随机化放置
                    FOR EACH product IN temp_products:
                        IF (product.p_r_count > 0):
                            // 检查是否能放下
                            IF (material.r_height >= product.p_height + saw_bite AND
                                material.r_width >= product.p_width + saw_bite):

                                // 放置产品
                                place_product(temp_material, product, saw_bite)
                                product.p_r_count--

                                // 计算余料
                                r_height = material.r_height - product.p_height - saw_bite
                                r_width = material.r_width - product.p_width - saw_bite

                                // 尝试在余料中放置更多产品
                                IF (r_height > 60 OR r_width > 60):
                                    recursiveFill(remainder_area, temp_products, saw_bite)

                    // 评估利用率
                    utilization = calculate_utilization(temp_material)

                    IF (utilization > best_utilization):
                        best_pattern = temp_material
                        best_utilization = utilization

                // 阶段 5: 如果利用率达标则接受方案
                IF (best_utilization >= scale_threshold):
                    result_materials.add(best_pattern)
                    update_product_counts(group_products, best_pattern)
                ELSE:
                    BREAK  // 无法达到阈值，尝试下一材料

    // 阶段 6: 后处理
    consolidatePatterns(result_materials)  // 合并相同方案
    calculateLeftovers(result_materials)    // 识别可复用余料

    RETURN result_materials
```

### 12.3 算法参数

| 参数 | 类型 | 范围 | 默认值 | 影响 |
|-----------|------|-------|---------|--------|
| saw_bite (锯口) | double | 2-6 mm | 3 mm | 每次切割的损耗；值越大浪费越多 |
| scale_threshold (利用率阈值) | double | 0.50-0.90 | 0.78 | 接受方案的最低利用率；值越高，废料多的板材越少 |
| placement_attempts (放置尝试次数) | int | 1-10 | 6 | 随机放置尝试次数；越高优化效果越好但速度越慢 |
| min_leftover_size (最小余料尺寸) | double | 100-500 mm | 200 mm | 可复用余料的最小尺寸 |

### 12.4 优化策略

#### 12.4.1 产品排序 (scoreAreaProduct)
```
按面积 (高 × 宽) 降序排列产品
理由: 先放置大产品以减少碎片化
```

#### 12.4.2 材料排序 (scoreMaterial)
```
按以下顺序排序材料:
1. 余料标志 (m_is_yl): 0 在 1 之前 (主材优先于余料)
2. 面积: 大板材优先

理由: 主生产优先使用主材，余料留给小件或零散件
```

#### 12.4.3 随机化搜索
```
对于每次放置尝试:
    - 随机选择切割方向 (垂直或水平)
    - 使用 Random.nextBoolean() 决定方向

理由: 探索多种解以避免陷入局部最优
权衡: 非确定性结果 (不同运行产生不同输出)
```

#### 12.4.4 递归填充余料
```
放置一个产品后:
1. 计算余料区域 (L形或矩形)
2. 尝试在余料空间中放置其他产品
3. 如果产品不能完美匹配，则递归地细分
4. 通过 m_f_id/m_node_id 跟踪余料的树形结构

理由: 通过填充每个可用空间来最大化利用率
```

### 12.5 算法复杂度分析

**时间复杂度:**
- 最坏情况: O(P × M × A × N²)
  - P = 产品分组数 (按颜色+厚度)
  - M = 可用材料数
  - A = 放置尝试次数 (默认 6)
  - N = 每个分组的平均产品数

- 典型情况: 对于单一材料类型，为 O(N² × M)

**空间复杂度:**
- O(N + M) 用于分组映射
- O(A × N) 用于尝试期间的深度克隆
- O(N²) 用于递归余料树

**性能瓶颈:**
- 基于序列化的深度克隆 (占执行时间的 60%+)
- 嵌套循环 (最坏情况下 5 层深)
- 没有对部分解进行缓存或记忆化

### 12.6 算法局限性

1. **不保证全局最优:**
   - 贪心方法只寻找局部最优解
   - 随机化有帮助但不能保证找到最佳解
   - 不同运行可能产生不同结果

2. **仅支持裁断式切割:**
   - 不能处理任意多边形形状
   - 所有切割必须是贯穿整个板材的直线
   - 降低了处理复杂几何形状的灵活性

3. **单一材料类型:**
   - 不能在同一张板材上混合颜色或厚度
   - 每种类型需要单独的优化运行
   - 可能错失跨材料优化的机会

4. **固定的板材尺寸:**
   - 只支持预定义的尺寸
   - 没有动态板材尺寸优化
   - 自定义尺寸需要修改代码

5. **计算可伸缩性:**
   - O(N²) 的复杂度限制了输入规模
   - 建议每次运行最多 100 种产品
   - 大订单可能需要分批处理

---

## 13. 集成需求

(由于篇幅限制，后续章节将以更简洁的方式呈现，但保持核心信息)

### 13.1 输入集成
- **当前:** 通过 Web 表单 POST 到 `/GV/createView.action`。
- **未来:** 通过 `/GV/api/optimize` 的 RESTful API 接受 JSON 输入。

### 13.2 输出集成
- **当前:** 通过 struts2-json-plugin 提供 JSON 响应，并由 JSP 渲染为 HTML。
- **未来:** 导出为 DXF/G-code 以与 CAD/CAM 系统集成。

### 13.3 外部系统集成 (未来)
- **ERP 集成:** 导入订单，导出切割计划。
- **CAD/CAM 集成:** 导出切割图到 CNC 机床。
- **库存管理:** 跟踪余料和材料消耗。

---

## 14. 成功指标

### 14.1 业务指标
- **材料利用率:** 从 60-70% (手动) 提升至 ≥ 75% (系统)。
- **规划时间:** 从 2-4 小时/订单缩短至 < 5 分钟/订单。
- **余料复用率:** 从 < 5% 提升至 ≥ 20%。

### 14.2 技术指标
- **响应时间:** 95百分位 < 5 秒。
- **系统正常运行时间:** 99%。
- **并发用户:** 10。

### 14.3 用户体验指标
- **用户培训时间:** < 10 分钟。
- **任务完成率:** > 95%。
- **用户满意度:** ≥ 4.0/5.0。

---

## 15. 约束与限制

### 15.1 技术约束
- **Java 7 兼容性:** 代码必须使用 Java 7 编译。
- **Tomcat 8.5.x 依赖:** 专为 Tomcat 设计。
- **单线程优化:** 每个请求顺序处理。
- **无数据库集成:** 无状态操作，不保存历史记录。

### 15.2 算法约束
- **仅裁断式切割:** 不支持不规则形状。
- **无全局最优保证:** 启发式算法寻找局部最优解。
- **结果随机性:** 每次运行结果可能不同。

### 15.3 业务约束
- **仅中文:** UI 和文档仅支持中文。
- **需要手动输入:** 无自动化订单导入。
- **无成本估算:** 不计算材料成本。

---

## 16. 未来增强功能

### 16.1 近期 (3-6 个月)
- **数据库集成:** 持久化结果和余料库存。
- **CSV/Excel 导入:** 减少手动输入。
- **自定义板材尺寸:** 允许用户定义非标准板材。

### 16.2 中期 (6-12 个月)
- **多用户支持:** 增加用户认证和角色。
- **分析仪表盘:** 提供利用率和成本节约报告。
- **改进算法:** 探索遗传算法或模拟退火。

### 16.3 远期 (12+ 个月)
- **CNC 机床集成:** 直接导出 G-code。
- **移动应用:** 供车间主管在平板上查看方案。
- **AI 驱动的优化:** 利用机器学习持续改进。

---

## 17. 依赖项

### 17.1 外部依赖
- **运行时库:** Struts 2, Spring 3, Commons 库等 29 个 JAR 文件。
- **编译时依赖:** `servlet-api.jar` (来自 Tomcat), JDK 7+。

### 17.2 基础设施依赖
- **服务器:** Linux (推荐), JRE 7+, Tomcat 8.5.x。
- **客户端:** 现代浏览器 (Chrome, Firefox, IE11+)。

---

## 18. 风险与缓解措施

### 18.1 技术风险
- **算法性能下降:** 大订单处理过慢。**缓解:** 限制输入数量，未来采用异步处理。
- **内存泄漏:** 深度克隆可能耗尽内存。**缓解:** 设置 JVM 内存限制，优化克隆逻辑。
- **字节码兼容性问题:** Java 版本不匹配。**缓解:** 明确文档要求，未来升级依赖。

### 18.2 业务风险
- **用户抵制变革:** 经验丰富的计划员不愿使用。**缓解:** 提供培训，展示成本节约案例。
- **输入数据不准确:** 用户输入错误尺寸。**缓解:** 加强输入验证，增加预览步骤。

### 18.3 运营风险
- **缺乏维护:** 部署后无人修复 bug。**缓解:** 提供完整文档，培训内部 IT 人员。
- **安全漏洞:** 无认证导致未授权访问。**缓解:** 部署在防火墙后，未来增加用户认证。

---

## 19. 附录

### 19.1 术语表
- **板材 (Board / Sheet):** 原材料面板。
- **产品/构件 (Product / Component):** 待切割的家具部件。
- **利用率 (Utilization Rate):** 板材面积被产品占用的百分比。
- **锯口/锯缝 (Saw Kerf):** 锯片切割时移除的材料宽度。
- **余料 (Leftover / Remnant):** 切割后剩余的可复用材料。
- **开料图 (Cutting Diagram):** 显示产品布局的可视化图纸。

### 19.2 标准板材规格 (中国)
- **4 × 8 呎:** 1220 × 2440 mm (最常用)
- **5 × 8 呎:** 1530 × 2440 mm
- (其他尺寸如原文所示)

### 19.3 代码仓库结构
(与原文相同，展示了源代码和配置文件的目录结构)

---

## 文档修订历史

| 版本 | 日期 | 作者 | 变更 |
|---------|------|--------|---------|
| 1.0 | 2025-11-08 | AI 分析 | 根据源代码逆向工程首次创建 PRD |

---

**文档结束**
